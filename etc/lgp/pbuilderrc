# Logilab lgp configuration file for pbuilder.
# Copyright (c) 2003-2009 LOGILAB S.A. (Paris, FRANCE).
# http://www.logilab.fr/ -- mailto:contact@logilab.fr

# The file in /usr/share/pbuilder/pbuilderrc is the default template.
# /etc/pbuilderrc is the one meant for editing.
#
# Read pbuilderrc.5 document for notes on specific options.

# This file is largely inspired by:
#     https://wiki.ubuntu.com/PbuilderHowto
#
# Thanks a lot, guys !

# The use of the codenames for Debian suites is managed by lgp directly.

# List of Debian suites
DEBIAN_SUITES=("unstable" "testing" "stable")

# List of Ubuntu suites. Update these when needed
UBUNTU_SUITES=("jaunty" "intrepid" "hardy" "gutsy" "feisty" "dapper")

# Mirrors to use. Update these to your preferred mirror.
#DEBIAN_MIRROR="cdn.debian.net/debian"
DEBIAN_MIRROR="ftp.fr.debian.org"
UBUNTU_MIRROR="fr.archive.ubuntu.com"

# You can use valid sources.list files to add your personal repositories...
DEBIAN_SOURCESLIST="/etc/lgp/sources.list.debian"
UBUNTU_SOURCESLIST="/etc/lgp/sources.list.ubuntu"
# Note: files matching *_SOURCESLIST.${DIST} in the same directory can be used
#       to override generic values
# ... or set theses variables in a sources.list format (see pbuilder man page)
# They will be used in the distribution image to fetch developped packages
DEBIAN_OTHERMIRROR=
UBUNTU_OTHERMIRROR=

# Optionally set a default distribution if none is used. Note that you can set
# your own default (i.e. ${DIST:="unstable"}).
#: ${DIST:="$(lsb_release --short --codename)"}
#: ${DIST:="unstable"}

# Optionally use the changelog of a package to determine the suite to use if
# none set.
if [ -z "${DIST}" ] && [ -r "debian/changelog" ]; then
	DIST=$(dpkg-parsechangelog | awk '/^Distribution: / {print $2}')
	# Use the unstable suite for Debian experimental packages.
	if [ "${DIST}" == "experimental" -o \
		 "${DIST}" == "UNRELEASED" -o \
		 "${DIST}" == "DISTRIBUTION" ]; then
		DIST="unstable"
	fi
	echo "Retrieve distribution from debian/changelog: $DIST"
fi

# Optionally set the architecture to the host architecture if none set. Note
# that you can set your own default (i.e. ${ARCH:="i386"}).
: ${ARCH:="$(dpkg --print-architecture)"}
#export DEBIAN_BUILDARCH=athlon

DISTRIBUTION="${DIST}"
NAME="${DIST}"
if [ -n "${ARCH}" ]; then
    NAME="$NAME-$ARCH"

    # The name of debootstrap command. Only cdebootstrap is supported
    DEBOOTSTRAP="cdebootstrap"

    #DEBOOTSTRAPOPTS=("--include" "sysv-rc" "--debug" "-v" "--arch" "$ARCH" "${DEBOOTSTRAPOPTS[@]}")
    DEBOOTSTRAPOPTS=("--include" "sysv-rc" "--arch" "$ARCH" "${DEBOOTSTRAPOPTS[@]}")
fi

#BUILDRESULT="/var/cache/pbuilder/$NAME/result/"
BUILDRESULT="/${HOME}/dists/${DIST}"
BUILDPLACE="/var/cache/pbuilder/build/"

# BASETGZ directory
BASETGZ="/opt/buildd/$NAME.tgz"
mkdir -p $(dirname $BASETGZ) 2>/dev/null
if [ ! -r ${BASETGZ} ]; then
	echo "Error: pbuilder image $BASETGZ has not been created" >/dev/stderr
	echo "Please use: lgp setup -c create -d $DIST"
	exit 1
fi

if $(echo ${DEBIAN_SUITES[@]} | grep -q $DIST); then
    # Debian configuration
    MIRRORSITE="http://$DEBIAN_MIRROR/debian/"
    COMPONENTS="main contrib non-free"
    eval "OTHERMIRROR=\"$(grep -v '#' $DEBIAN_SOURCESLIST | tr '\n' '|')\""
    [[ -f $DEBIAN_SOURCESLIST.$DIST ]] && OTHERMIRROR=$(grep -v '#' $DEBIAN_SOURCESLIST.$DIST | tr '\n' '|')
    OTHERMIRROR=${OTHERMIRROR:-$DEBIAN_OTHERMIRROR}
elif $(echo ${UBUNTU_SUITES[@]} | grep -q $DIST); then
    # Ubuntu configuration
    MIRRORSITE="http://$UBUNTU_MIRROR/ubuntu/"
    COMPONENTS="main restricted universe multiverse"
    eval "OTHERMIRROR=\"$(grep -v '#' $UBUNTU_SOURCESLIST | tr '\n' '|')\""
    [[ -f $UBUNTU_SOURCESLIST.$DIST ]] && OTHERMIRROR=$(grep -v '#' $UBUNTU_SOURCESLIST.$DIST | tr '\n' '|')
    OTHERMIRROR=${OTHERMIRROR:-$UBUNTU_OTHERMIRROR}
else
    echo "Unknown distribution: $DIST"
    exit 1
fi

#export http_proxy=http://your-proxy:8080/
USEPROC=yes
USEDEVPTS=yes
USEDEVFS=no

# BINDMOUNTS is a space separated list of things to mount
# inside the chroot.
BINDMOUNTS="/sys"

# Specify the cache for APT
APTCACHE="/var/cache/pbuilder/$NAME/aptcache/"
#APTCACHEHARDLINK="yes"
#REMOVEPACKAGES="lilo bash"
REMOVEPACKAGES="lilo"
#EXTRAPACKAGES=gcc3.0-athlon-builder

# "debconf: delaying package configuration, since apt-utils is not installed"
EXTRAPACKAGES=apt-utils

# Make debconf not interact with user
export DEBIAN_FRONTEND="noninteractive"

DEBEMAIL=""

#for pbuilder debuild
BUILDSOURCEROOTCMD="fakeroot"
PBUILDERROOTCMD="sudo"

# command to satisfy build-dependencies; the default is an internal shell
# implementation which is relatively slow; there are two alternate
# implementations, the "experimental" implementation,
# "pbuilder-satisfydepends-experimental", which might be useful to pull
# packages from experimental or from repositories with a low APT Pin Priority,
# and the "aptitude" implementation, which will resolve build-dependencies and
# build-conflicts with aptitude which helps dealing with complex cases but does
# not support unsigned APT repositories
PBUILDERSATISFYDEPENDSCMD="/usr/lib/pbuilder/pbuilder-satisfydepends"

#Command-line option passed on to dpkg-buildpackage.
#DEBBUILDOPTS="-IXXX -iXXX"
DEBBUILDOPTS=""

# Hooks directory for pbuilder
#HOOKDIR="/etc/lgp/hooks"

# APT configuration files directory
#APTCONFDIR="/etc/lgp/apt.d"

# the username and ID used by pbuilder, inside chroot. Needs fakeroot, really
BUILDUSERID=1234
BUILDUSERNAME=pbuilder

# Set the PATH I am going to use inside pbuilder
#export PATH="/usr/local/sbin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/X11R6/bin"

# SHELL variable is used inside pbuilder by commands like 'su'; and they need sane values
export SHELL=/bin/sh

# enable pkgname-logfile
PKGNAME_LOGFILE_EXTENTION="_$(dpkg --print-architecture).build"
PKGNAME_LOGFILE=yes

# When this value is set to yes, pdebuild will invoke debsign command after building.
AUTO_DEBSIGN=yes

#TIMEOUT_TIME=20min
